<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, viewport-fit=cover"
    />
    <title>BEM IDE LPKIA â€” Reminder</title>

    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
      /* === Brand colors (BEM IDE LPKIA) === */
      :root {
        --primary: #2b2890;
        --primary-600: #1e1a78;
        --accent: #574dff;
        --bg: #f4f5ff;
        --card: #ffffff;
        --muted: #6b6b6b;
        --success: #059669;
        --navbar-height: 56px;
      }

      /* === Reset & layout === */
      * {
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }
      body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        background: var(--bg);
        color: #111827;
        padding-top: var(--navbar-height); /* Space for fixed navbar */
        padding-bottom: 40px;
      }

      /* === Mobile Navigation Bar === */
      .mobile-navbar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: var(--navbar-height);
        background: var(--primary);
        display: flex;
        align-items: center;
        padding: 0 16px;
        z-index: 1000;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        color: white;
      }
      .nav-left {
        display: flex;
        align-items: center;
        margin-right: 16px;
        cursor: pointer;
      }
      .nav-title {
        font-weight: 600;
        font-size: 18px;
        flex: 1;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .back-icon {
        width: 24px;
        height: 24px;
        fill: none;
        stroke: white;
        stroke-width: 2;
        stroke-linecap: round;
        stroke-linejoin: round;
      }

      /* === Main Layout === */
      .wrap {
        max-width: 1100px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 1fr 420px;
        gap: 20px;
        padding: 20px;
        align-items: start;
      }

      /* === Cards === */
      .card {
        background: var(--card);
        border-radius: 14px;
        padding: 18px;
        box-shadow: 0 4px 15px rgba(15, 23, 42, 0.05);
        border: 1px solid rgba(43, 40, 144, 0.06);
        margin-bottom: 20px;
      }
      h1 {
        margin: 0 0 8px;
        font-size: 18px;
        color: var(--primary-600);
      }
      p.lead {
        margin: 0 0 16px;
        color: var(--muted);
        font-size: 13px;
        line-height: 1.5;
      }

      /* === Form Elements === */
      label {
        display: block;
        font-size: 13px;
        color: #0b1220;
        margin-bottom: 6px;
        font-weight: 600;
      }
      input[type="text"],
      input[type="datetime-local"],
      select,
      textarea {
        width: 100%;
        padding: 12px;
        border-radius: 10px;
        border: 1px solid #e6e9fb;
        background: #fff;
        font-size: 14px;
        color: #0b1220;
        outline: none;
        /* Prevent zoom on mobile */
        font-size: 16px; 
      }
      textarea {
        min-height: 90px;
        resize: vertical;
      }
      input:focus,
      select:focus,
      textarea:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(87, 77, 255, 0.1);
      }

      .grid-2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }

      /* === Buttons === */
      .actions {
        display: flex;
        gap: 10px;
        margin-top: 16px;
      }
      .export-actions {
        display: flex;
        flex-direction: column; /* Stack buttons on mobile */
        gap: 8px;
        margin-top: 12px;
      }

      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 14px;
        border-radius: 12px;
        border: none;
        cursor: pointer;
        font-weight: 600;
        color: white;
        font-size: 14px;
        width: 100%; /* Full width on mobile */
        transition: transform 0.1s;
      }
      .btn:active {
        transform: scale(0.98);
      }
      .btn-primary { background: var(--primary-600); }
      .btn-ghost {
        background: transparent;
        color: var(--primary-600);
        border: 1px solid rgba(43, 40, 144, 0.2);
      }
      .btn-export { background: var(--accent); }
      .btn-wa { background: #25D366; color: white; }

      /* === Preview & Table === */
      .list-title {
        font-weight: 700;
        color: var(--primary-600);
        margin-bottom: 8px;
      }
      .table-wrapper {
        overflow-x: auto; /* Scrollable table */
      }
      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 13px;
        white-space: nowrap; /* Keep rows single line */
      }
      th, td {
        padding: 12px 10px;
        border-bottom: 1px solid #eef2ff;
        text-align: left;
      }
      th {
        background: #fbfbff;
        color: var(--primary-600);
        font-weight: 700;
      }

      .meta {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-top: 10px;
        font-size: 12px;
      }
      .chip {
        background: #f3f4ff;
        padding: 4px 10px;
        border-radius: 20px;
        color: var(--primary-600);
        font-weight: 600;
        font-size: 11px;
      }

      /* === RESPONSIVE MEDIA QUERIES === */
      @media (max-width: 980px) {
        .wrap {
          grid-template-columns: 1fr; /* Single column */
          padding: 16px;
        }
        .side {
          margin-top: 20px;
        }
        /* Make date input readable on mobile */
        input[type="datetime-local"] {
          appearance: none; 
          min-height: 48px;
        }
      }
    </style>
  </head>
  <body>

    <nav class="mobile-navbar">
      <div class="nav-left" onclick="goBack()">
        <svg class="back-icon" viewBox="0 0 24 24">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </div>
      <div class="nav-title">Notifikasi & Rapat</div>
    </nav>

    <div class="wrap">
      <div class="card">
        <h1>Buat Laporan / Reminder</h1>
        <p class="lead">
          Isi form di bawah untuk membuat pengingat atau laporan hasil rapat organisasi.
        </p>

        <div style="display: grid; gap: 14px">
          <div>
            <label>Judul Notifikasi</label>
            <input id="notif-title" type="text" placeholder="Contoh: Rapat Koordinasi" />
          </div>

          <div>
            <label>Pesan Singkat</label>
            <textarea id="notif-message" style="min-height: 60px;" placeholder="Pesan singkat untuk broadcast..."></textarea>
          </div>

          <div class="grid-2">
            <div>
              <label>Waktu</label>
              <input id="notif-time" type="datetime-local" />
            </div>
            <div>
              <label>Prioritas</label>
              <select id="notif-priority">
                <option value="Biasa">Biasa</option>
                <option value="Penting">Penting</option>
              </select>
            </div>
          </div>

          <div>
            <label>Lokasi (Singkat)</label>
            <input id="notif-location" type="text" placeholder="Contoh: Sekre BEM" />
          </div>

          <hr style="border: none; border-top: 1px dashed #eef2ff; margin: 10px 0;" />

          <div style="display: grid; gap: 12px">
            <div class="grid-2">
                <div>
                    <label>Pengirim</label>
                    <select id="sender-name">
                        <option>Ketua</option>
                        <option>Sekretaris</option>
                        <option>Bendahara</option>
                        <option>Lainnya</option>
                    </select>
                </div>
                <div>
                     <label>Urgensi</label>
                     <select id="meeting-urgency">
                        <option value="Low">Low</option>
                        <option value="Medium">Medium</option>
                        <option value="High">High</option>
                     </select>
                </div>
            </div>

            <div>
              <label>Nama ORMAWA</label>
              <input id="ormawa-name" type="text" placeholder="BEM / HMIF / HMSI..." />
            </div>

            <div>
              <label>Detail Pembahasan</label>
              <textarea id="meeting-desc" placeholder="Isi pembahasan rapat secara detail..."></textarea>
            </div>
          </div>

            <div class="actions">
            <button class="btn btn-primary" onclick="setReminder()">Simpan Data</button>
            <button class="btn btn-ghost" onclick="clearForm()" style="width: 40%;">Reset</button>
          </div>

          <div class="export-actions">
            <button class="btn btn-export" onclick="exportAllPDF()">
               Download PDF Laporan
            </button>
            <button class="btn btn-wa" onclick="exportWA()">
               Kirim ke WhatsApp
            </button>
            <button class="btn btn-ghost" onclick="exportExcel()">
               Export Excel
            </button>
          </div>
        </div>
      </div>

      <aside class="side">
        <div class="card">
          <div class="list-title">Preview Terakhir</div>
          <div id="preview-empty" class="small" style="color:#888; font-style:italic;">Belum ada input baru.</div>

          <div id="preview" style="display: none">
            <div><strong id="pv-title" style="font-size:16px;"></strong></div>
            <div class="meta">
              <div class="chip" id="pv-priority"></div>
              <div class="chip" id="pv-time"></div>
            </div>
            <p id="pv-desc" style="margin-top: 10px; color: var(--muted); font-size:14px;"></p>
            <hr style="margin: 12px 0; border: none; border-top: 1px solid #f0f4ff;" />
            
            <div style="font-size:13px; line-height: 1.6;">
                <div><strong>Pengirim:</strong> <span id="pv-sender"></span></div>
                <div><strong>Ormawa:</strong> <span id="pv-ormawa"></span></div>
            </div>
          </div>
        </div>

        <div class="card" style="margin-top: 10px">
          <div class="list-title">Riwayat Data</div>
          <div id="list-empty" class="small" style="color:#888;">Belum ada data.</div>
          
          <div class="table-wrapper">
              <table id="table-data" style="display: none">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Judul</th>
                    <th>Waktu</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
          </div>
        </div>
      </aside>
    </div>

    <script>
      // === FUNGSI TOMBOL BACK (REVISI) ===
      function goBack() {
        // Cek apakah user bisa kembali ke halaman sebelumnya (History Browser)
        if (window.history.length > 1 && document.referrer.includes('dashboard')) {
            window.history.back();
        } else {
            // Jika dibuka langsung (tidak ada history), paksa ke Dashboard Admin
            // Perhatikan jalur ini: /src/pages/dashboard/...
            window.location.href = '/src/pages/dashboard/dashboard-admin.html'; 
        }
      }

      // === LOGIC DATA ===
      const storageKey = "bem_reminders_v2";

      function loadData() {
        return JSON.parse(localStorage.getItem(storageKey) || "[]");
      }

      function saveData(arr) {
        localStorage.setItem(storageKey, JSON.stringify(arr));
      }

      function refreshUI() {
        const data = loadData();
        const preview = document.getElementById("preview");
        const previewEmpty = document.getElementById("preview-empty");
        const listEmpty = document.getElementById("list-empty");
        const table = document.getElementById("table-data");
        const tbody = table.querySelector("tbody");

        if (data.length === 0) {
          preview.style.display = "none";
          previewEmpty.style.display = "block";
          table.style.display = "none";
          listEmpty.style.display = "block";
        } else {
          const last = data[data.length - 1];
          preview.style.display = "block";
          previewEmpty.style.display = "none";
          
          // Set Preview Values
          document.getElementById("pv-title").innerText = last.title;
          document.getElementById("pv-desc").innerText = last.desc;
          document.getElementById("pv-priority").innerText = last.priority;
          document.getElementById("pv-time").innerText = new Date(last.datetime).toLocaleDateString() + ' ' + new Date(last.datetime).toLocaleTimeString().slice(0,5);
          document.getElementById("pv-sender").innerText = last.sender;
          document.getElementById("pv-ormawa").innerText = last.ormawa || "-";

          // Set Table Values
          tbody.innerHTML = "";
          // Ambil 5 data terakhir saja biar tidak panjang
          const recentData = data.slice().reverse().slice(0, 5);
          
          recentData.forEach((d) => {
            const tr = document.createElement("tr");
            const dateStr = new Date(d.datetime).toLocaleDateString();
            tr.innerHTML = `<td style="font-weight:700">${d.id}</td><td>${d.title}</td><td>${dateStr}</td>`;
            tbody.appendChild(tr);
          });
          table.style.display = "table";
          listEmpty.style.display = "none";
        }
      }

      // Initial Load
      refreshUI();

      function clearForm() {
        document.querySelectorAll('input, textarea, select').forEach(el => {
            if (el.tagName === "SELECT") el.selectedIndex = 0;
            else el.value = "";
        });
      }

      function setReminder() {
        const title = document.getElementById("notif-title").value.trim();
        const desc = document.getElementById("notif-message").value.trim();
        const datetime = document.getElementById("notif-time").value;
        const priority = document.getElementById("notif-priority").value;
        const location = document.getElementById("notif-location").value.trim();
        const sender = document.getElementById("sender-name").value;
        const ormawa = document.getElementById("ormawa-name").value.trim();
        const urgency = document.getElementById("meeting-urgency").value;
        const meetingDesc = document.getElementById("meeting-desc").value.trim();

        if (!title || !desc || !datetime) {
          alert("Judul, pesan, dan waktu wajib diisi!");
          return;
        }

        const data = loadData();
        // ID Pendek untuk mobile
        const id = "N-" + Math.floor(Math.random() * 1000); 
        
        const item = {
          id, title, desc, datetime, priority, location,
          sender, ormawa, urgency, meetingDesc,
          createdAt: new Date().toISOString(),
        };

        data.push(item);
        saveData(data);
        refreshUI();
        
        // Simulasi notif
        alert("Data berhasil disimpan!");
        clearForm();
      }

      // --- EXPORT PDF ---
      function exportAllPDF() {
        const data = loadData();
        if (data.length === 0) { alert("Data kosong."); return; }

        let html = `<div style="font-family:sans-serif; padding:20px;">`;
        html += `<h2 style="color:#2b2890; border-bottom:2px solid #ddd; padding-bottom:10px;">Laporan Rapat BEM</h2>`;
        
        data.forEach((d, idx) => {
           html += `<div style="margin-bottom:20px; border:1px solid #eee; padding:10px;">`;
           html += `<h3>${idx+1}. ${d.title} (${d.ormawa || 'Umum'})</h3>`;
           html += `<p><strong>Waktu:</strong> ${new Date(d.datetime).toLocaleString()}</p>`;
           html += `<p><strong>Pesan:</strong> ${d.desc}</p>`;
           html += `<p><strong>Detail:</strong> ${d.meetingDesc || '-'}</p>`;
           html += `</div>`;
        });
        html += `</div>`;

        const opt = {
          margin: 10,
          filename: 'Laporan_Rapat.pdf',
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: { scale: 2 },
          jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };
        html2pdf().from(html).set(opt).save();
      }

      // --- EXPORT WA ---
      function exportWA() {
        const data = loadData();
        if (data.length === 0) { alert("Data kosong."); return; }
        
        // Ambil data terakhir saja untuk WA
        const last = data[data.length - 1];
        
        let text = `*LAPORAN / REMINDER RAPAT*\n`;
        text += `--------------------------\n`;
        text += `Judul: ${last.title}\n`;
        text += `Ormawa: ${last.ormawa || '-'}\n`;
        text += `Waktu: ${new Date(last.datetime).toLocaleString()}\n`;
        text += `Lokasi: ${last.location || '-'}\n`;
        text += `Pesan: ${last.desc}\n`;
        text += `--------------------------\n`;
        text += `_Dikirim via App Presensi Ormawa_`;

        window.open("https://wa.me/?text=" + encodeURIComponent(text), "_blank");
      }

      // --- EXPORT EXCEL ---
      function exportExcel() {
        const data = loadData();
        if (data.length === 0) { alert("Data kosong."); return; }
        const ws = XLSX.utils.json_to_sheet(data);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Data");
        XLSX.writeFile(wb, "Data_Laporan.xlsx");
      }
    </script>
  </body>
</html>