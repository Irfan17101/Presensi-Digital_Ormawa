<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    <title>Admin Dashboard - Presinize</title>
    
    <link rel="stylesheet" href="https://unpkg.com/framework7/framework7-bundle.min.css" />
    <script src="https://unpkg.com/framework7/framework7-bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="../../js/firebase-config.js"></script>

    <style>
        /* CSS Tetap Sama */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif; }
        body { background: #f5f5f7; min-height: 100vh; }
        .admin-header { background: linear-gradient(135deg, #ff6b6b, #ff8e8e); color: white; padding: 60px 20px 20px 20px; border-bottom-left-radius: 25px; border-bottom-right-radius: 25px; }
        .admin-badge { background: rgba(255,255,255,0.3); padding: 6px 14px; border-radius: 20px; font-size: 0.8rem; display: inline-block; margin-bottom: 10px; font-weight: 600; }
        .admin-info h1 { font-size: 1.8rem; margin-bottom: 5px; font-weight: 700; }
        .admin-info p { opacity: 0.9; margin-bottom: 5px; font-size: 0.9rem; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 20px; margin-top: -40px; }
        .stat-card { background: white; padding: 20px; border-radius: 16px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); text-align: center; border-left: 4px solid #ff6b6b; }
        .stat-number { font-size: 2rem; font-weight: 700; color: #ff6b6b; margin-bottom: 5px; }
        .stat-label { color: #666; font-size: 0.9rem; font-weight: 500; }
        .admin-menu { padding: 20px; }
        .menu-title { font-size: 1.2rem; font-weight: 700; color: #333; margin-bottom: 15px; }
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .menu-item { background: white; padding: 25px 15px; border-radius: 16px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1); cursor: pointer; transition: all 0.3s ease; border: 2px solid transparent; }
        .menu-item.admin-feature { border: 2px solid #ff6b6b; }
        .menu-item:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.15); }
        .menu-icon { font-size: 2rem; margin-bottom: 10px; }
        .menu-label { font-weight: 600; color: #333; font-size: 0.9rem; }
        .logout-section { padding: 20px; text-align: center; }
        .logout-btn { background: #ff4757; color: white; border: none; padding: 15px 30px; border-radius: 12px; font-weight: 600; cursor: pointer; width: 100%; max-width: 200px; font-size: 1rem; }
        .logout-btn:hover { background: #ff3742; }
    </style>
</head>
<body>
    <div class="admin-header">
        <div class="admin-badge">ADMIN</div>
        <div class="admin-info">
            <h1 id="adminName">Admin Name</h1>
            <p id="adminOrg">Organization</p>
            <p id="adminEmail">Email: -</p>
        </div>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-number" id="totalAnggota">0</div>
            <div class="stat-label">Total Anggota</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="persentaseKehadiran">0%</div>
            <div class="stat-label">Rata-rata Kehadiran</div>
        </div>
    </div>

    <div class="admin-menu">
        <div class="menu-title">Menu Admin</div>
        <div class="menu-grid">
            <div class="menu-item admin-feature" onclick="kelolaAnggota()">
                <div class="menu-icon">ðŸ‘¥</div>
                <div class="menu-label">Kelola Anggota</div>
            </div>
            <div class="menu-item admin-feature" onclick="laporanPresensi()">
                <div class="menu-icon">ðŸ“Š</div>
                <div class="menu-label">Laporan Presensi</div>
            </div>
            <div class="menu-item admin-feature" onclick="kelolaKegiatan()">
                <div class="menu-icon">ðŸ“…</div>
                <div class="menu-label">Kelola Kegiatan</div>
            </div>
            <div class="menu-item admin-feature" onclick="exportData()">
                <div class="menu-icon">ðŸ“¤</div>
                <div class="menu-label">Export Data</div>
            </div>
            <div class="menu-item" onclick="lihatNotifikasi()">
                <div class="menu-icon">ðŸ””</div>
                <div class="menu-label">Notifikasi</div>
            </div>
            <div class="menu-item" onclick="lihatRekap()">
                <div class="menu-icon">ðŸ“‹</div>
                <div class="menu-label">Rekap Izin</div>
            </div>
        </div>
    </div>

    <div class="logout-section">
        <button class="logout-btn" onclick="logout()">Logout</button>
    </div>

    <script>
        // Cek login admin
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        
        if(!currentUser) {
            // PERBAIKAN: Keluar folder dashboard -> masuk folder auth
            window.location.href = '../auth/login.html';
        } else if(currentUser.role !== 'admin') {
            alert('Akses ditolak. Hanya untuk admin.');
            // Tetap di folder dashboard, hanya ganti file
            window.location.href = 'dashboard-anggota.html';
        } else {
            document.getElementById('adminName').textContent = currentUser.name || 'Admin';
            document.getElementById('adminOrg').textContent = currentUser.organization || 'Organisasi';
            document.getElementById('adminEmail').textContent = 'Email: ' + currentUser.email;
            
            loadAdminStats();
        }

        function loadAdminStats() {
            if (window.firebase) {
                const db = firebase.database();
                // Hitung total anggota
                db.ref('users').once('value').then((snapshot) => {
                    const users = snapshot.val();
                    let totalAnggota = 0;
                    if (users) {
                        Object.keys(users).forEach(uid => {
                            if (users[uid].role === 'user') totalAnggota++;
                        });
                    }
                    document.getElementById('totalAnggota').textContent = totalAnggota;
                });
                
                // Hitung persentase kehadiran
                db.ref('presensi').once('value').then((snapshot) => {
                    const presensi = snapshot.val();
                    let totalHadir = 0;
                    let totalRecords = 0;
                    if (presensi) {
                        Object.keys(presensi).forEach(key => {
                            if (presensi[key].status === 'Hadir') totalHadir++;
                            totalRecords++;
                        });
                    }
                    const persentase = totalRecords > 0 ? Math.round((totalHadir / totalRecords) * 100) : 0;
                    document.getElementById('persentaseKehadiran').textContent = persentase + '%';
                });
            }
        }

        function kelolaAnggota() { alert('Fitur Kelola Anggota akan segera hadir!'); }

        function laporanPresensi() {
            // Keluar folder dashboard -> masuk folder rekap
            window.location.href = '../rekap/kehadiran.html';
        }

        function kelolaKegiatan() { alert('Fitur Kelola Kegiatan akan segera hadir!'); }
        function exportData() { alert('Fitur Export Data akan segera hadir!'); }

        function lihatNotifikasi() {
            // Keluar folder dashboard -> cari file di root pages
            window.location.href = '../notifications.html';
        }

        function lihatRekap() {
            // Keluar folder dashboard -> masuk folder rekap
            window.location.href = '../rekap/izin.html';
        }

        async function logout() {
            try {
                if (window.firebase) {
                    await firebase.auth().signOut();
                }
                localStorage.removeItem('currentUser');
                // PERBAIKAN: Keluar folder dashboard -> masuk folder auth
                window.location.href = '../auth/login.html';
            } catch (error) {
                console.error('Logout error:', error);
                localStorage.removeItem('currentUser');
                window.location.href = '../auth/login.html';
            }
        }
    </script>
</body>
</html>