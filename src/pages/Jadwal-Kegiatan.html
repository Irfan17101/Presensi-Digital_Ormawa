<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <title>Jadwal Kegiatan</title>

    <link
      rel="stylesheet"
      href="https://unpkg.com/framework7/framework7-bundle.min.css"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
    />

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <script src="../js/firebase-config.js"></script>

    <style>
      :root {
        --f7-theme-color: #3b0eac;
        --f7-page-bg-color: #f5f5f7;
      }
      .navbar-bg {
        background: linear-gradient(135deg, #3b0eac, #5d2ee6);
      }
      .navbar .title,
      .navbar .link {
        color: white;
      }
      .filter-container {
        padding: 15px 16px 5px 16px;
        display: flex;
        gap: 10px;
        overflow-x: auto;
        scrollbar-width: none;
      }
      .filter-chip {
        background: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 600;
        color: #666;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        transition: all 0.3s;
        border: 1px solid transparent;
        cursor: pointer;
      }
      .filter-chip.active {
        background: #3b0eac;
        color: white;
        box-shadow: 0 4px 10px rgba(59, 14, 172, 0.3);
      }
      .activity-card {
        background: #fff;
        border-radius: 18px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.06);
        margin: 0 16px 16px;
        overflow: hidden;
        position: relative;
      }
      .card-content-inner {
        display: flex;
        padding: 16px;
        align-items: flex-start;
      }
      .status-strip {
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 6px;
      }
      .activity-date-box {
        background: #f8f9fa;
        border-radius: 12px;
        text-align: center;
        padding: 10px 8px;
        width: 50px;
        margin-right: 15px;
        flex-shrink: 0;
        border: 1px solid #eee;
      }
      .date-month {
        font-size: 10px;
        font-weight: 700;
        color: #888;
        margin-bottom: 4px;
        text-transform: uppercase;
      }
      .date-day {
        font-size: 22px;
        font-weight: 800;
        color: #333;
        line-height: 1;
      }
      .activity-info {
        flex: 1;
      }
      .activity-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 6px;
      }
      .activity-title {
        font-weight: 700;
        font-size: 16px;
        color: #222;
      }
      .status-badge {
        font-size: 10px;
        font-weight: 700;
        padding: 4px 8px;
        border-radius: 6px;
        text-transform: uppercase;
      }
      .activity-details {
        font-size: 13px;
        color: #666;
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      .detail-item {
        display: flex;
        align-items: center;
        gap: 6px;
      }

      /* Status Colors */
      .status-live .status-strip {
        background: #2ecc71;
      }
      .status-live .status-badge {
        background: #fff3e0;
        color: #2ecc71;
      }
      .status-upcoming .status-strip {
        background: #f1c40f;
      }
      .status-upcoming .status-badge {
        background: #fef9e7;
        color: #f1c40f;
      }
      .status-done .status-strip {
        background: #95a5a6;
      }
      .status-done .status-badge {
        background: #f0f0f0;
        color: #95a5a6;
        opacity: 0.7;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div class="view view-main">
        <div class="page">
          <div class="navbar">
            <div class="navbar-bg"></div>
            <div class="navbar-inner">
              <div class="left">
                <a
                  href="dashboard/dashboard-anggota.html"
                  class="link icon-only external"
                >
                  <i class="icon material-icons">arrow_back</i>
                </a>
              </div>
              <div class="title">Jadwal Kegiatan</div>
            </div>
          </div>

          <div class="page-content">
            <div class="filter-container">
              <div
                class="filter-chip active"
                onclick="selectFilter(this, 'all')"
              >
                Semua
              </div>
              <div class="filter-chip" onclick="selectFilter(this, 'live')">
                Berlangsung
              </div>
              <div class="filter-chip" onclick="selectFilter(this, 'upcoming')">
                Akan Datang
              </div>
            </div>

            <div
              class="block-title"
              style="margin-top: 20px; margin-bottom: 10px"
            >
              Daftar Kegiatan
            </div>

            <div
              class="list no-hairlines"
              id="schedule-list"
              style="margin-top: 0"
            >
              <div style="text-align: center; padding: 40px; color: #999">
                <span class="preloader color-multi"></span>
                <p>Memuat data...</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://unpkg.com/framework7/framework7-bundle.min.js"></script>
    <script>
      var app = new Framework7({ el: "#app", theme: "ios" });

      document.addEventListener("DOMContentLoaded", function () {
        if (typeof firebase === "undefined" || !firebase.apps.length) {
          document.getElementById("schedule-list").innerHTML =
            '<div style="text-align:center; padding:20px; color:red">Error: Firebase Config tidak ditemukan.<br>Cek path: ../js/firebase-config.js</div>';
          return;
        }
        loadSchedules();
      });

      const months = [
        "JAN",
        "FEB",
        "MAR",
        "APR",
        "MEI",
        "JUN",
        "JUL",
        "AGU",
        "SEP",
        "OKT",
        "NOV",
        "DES",
      ];

      function loadSchedules() {
        firebase
          .database()
          .ref("kegiatan")
          .on("value", (snapshot) => {
            const list = document.getElementById("schedule-list");
            list.innerHTML = "";

            if (!snapshot.exists()) {
              list.innerHTML =
                '<div style="text-align:center; padding:30px; color:#999">Belum ada kegiatan.</div>';
              return;
            }

            const items = [];
            snapshot.forEach((child) => items.push(child.val()));
            items.sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal));

            items.forEach((ev) => {
              const today = new Date();
              today.setHours(0, 0, 0, 0);
              const evDate = new Date(ev.tanggal);
              evDate.setHours(0, 0, 0, 0);

              let stCls = "status-done",
                stTxt = "Selesai";
              if (evDate.getTime() === today.getTime()) {
                stCls = "status-live";
                stTxt = "Live";
              } else if (evDate > today) {
                stCls = "status-upcoming";
                stTxt = "Segera";
              }

              const m = months[evDate.getMonth()] || "-";
              const d = evDate.getDate().toString().padStart(2, "0");

              const html = `
              <div class="activity-card ${stCls}" onclick="app.dialog.alert('Waktu: ${ev.waktu}<br>Lokasi: ${ev.lokasi}', '${ev.nama}')">
                <div class="status-strip"></div>
                <div class="card-content-inner">
                  <div class="activity-date-box"><div class="date-month">${m}</div><div class="date-day">${d}</div></div>
                  <div class="activity-info">
                    <div class="activity-header"><div class="activity-title">${ev.nama}</div><div class="status-badge">${stTxt}</div></div>
                    <div class="activity-details">
                      <div class="detail-item"><i class="icon material-icons" style="font-size:16px;color:#999">schedule</i><span>${ev.waktu} WIB</span></div>
                      <div class="detail-item"><i class="icon material-icons" style="font-size:16px;color:#999">place</i><span>${ev.lokasi}</span></div>
                    </div>
                  </div>
                </div>
              </div>`;
              list.insertAdjacentHTML("beforeend", html);
            });
          });
      }

      function selectFilter(el, type) {
        document
          .querySelectorAll(".filter-chip")
          .forEach((c) => c.classList.remove("active"));
        el.classList.add("active");
        document.querySelectorAll(".activity-card").forEach((c) => {
          if (type === "all") c.style.display = "block";
          else
            c.style.display = c.classList.contains("status-" + type)
              ? "block"
              : "none";
        });
      }
    </script>
  </body>
</html>
